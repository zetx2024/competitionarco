<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator with Template and QR Code</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #qrcode {
            display: none; /* Hide QR code element as it will be used for generating the image */
        }
    </style>
</head>
<body>

    <div class="form-container">
        <h2>Generate Certificates with QR Codes</h2>
        <button type="button" onclick="generateCertificates()">Generate Certificates</button>
    </div>

    <div id="qrcode"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        const students = [
            { "name": "Alice Johnson", "institute": "XYZ University", "program": "Computer Science" },
            { "name": "Bob Smith", "institute": "XYZ University", "program": "Mechanical Engineering" },
            { "name": "Charlie Davis", "institute": "XYZ University", "program": "Civil Engineering" }
        ];

        // Function to generate QR code for a student
        function generateQRCode(text, callback) {
            const qrElement = document.getElementById('qrcode');
            qrElement.innerHTML = '';
            const qrCode = new QRCode(qrElement, {
                text: text,
                width: 100,
                height: 100,
                correctLevel: QRCode.CorrectLevel.H
            });
            // Wait for QR code to be generated
            setTimeout(() => {
                const qrCanvas = qrElement.querySelector('canvas');
                const qrDataUrl = qrCanvas.toDataURL('image/png');
                callback(qrDataUrl);
            }, 500); // Delay to ensure QR code is rendered
        }

        // Function to load template PDF and generate new PDF
        function generateCertificates() {
            const { jsPDF } = window.jspdf;

            // Load the PDF template file as base64
            const pdfTemplateUrl = 'template.pdf'; // The path to the certificate template PDF

            students.forEach((student) => {
                fetch(pdfTemplateUrl)
                    .then(response => response.arrayBuffer())
                    .then(data => {
                        // Create a new jsPDF document
                        const doc = new jsPDF();

                        // Add the template PDF as background
                        const pdfAsDataUri = new Uint8Array(data);
                        doc.addFileToVFS('template.pdf', pdfAsDataUri);
                        doc.addImage('template.pdf', 'PDF', 0, 0, 210, 297);

                        // Prepare student information
                        const qrText = `Name: ${student.name}\nInstitute: ${student.institute}\nProgram: ${student.program}`;
                        const description = `${student.name} has successfully completed the ${student.program} program at ${student.institute}.`;

                        // Generate QR code for the student
                        generateQRCode(qrText, (qrDataUrl) => {
                            // Add student details to the PDF
                            doc.setFontSize(16);
                            doc.text(student.name, 105, 150, { align: 'center' }); // Adjust position as needed
                            doc.text(student.institute, 105, 160, { align: 'center' });
                            doc.text(student.program, 105, 170, { align: 'center' });

                            // Add QR code image at desired position (bottom-right corner in this example)
                            doc.addImage(qrDataUrl, 'PNG', 160, 200, 40, 40); // Adjust size and position as needed

                            // Save the PDF with the student's name
                            doc.save(`certificate_${student.name}.pdf`);
                        });
                    })
                    .catch(error => console.error('Error loading template PDF:', error));
            });
        }
    </script>

</body>
</html>
